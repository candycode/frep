varying vec4 color;

vec4 ComputeColor( vec3 P, vec3 n )
{
  vec3 N = faceforward( n, lightDir, n );
  float d = dot( N, -lightDir );
  float s = pow( max( 0.0, dot( vec3( 0, 0, 1 ), reflect( lightDir, N ) ) ), sh );
  float a = color.a * ( 1. - dot( vec3( 0., 0., 1 ), n ) );
  return vec4(  ks * s * refcolor + kd * d * color.rgb + ka * color.rgb, a );
}